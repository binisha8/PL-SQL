--Showing total salary per job TITLE  within each department
SELECT 
    D.DEPARTMENT_NAME,
    J.JOB_TITLE,
    SUM(SALARY) AS TOTAL_SALARY
FROM HR.EMPLOYEES E
JOIN HR.DEPARTMENTS D
ON E.DEPARTMENT_ID=D.DEPARTMENT_ID
JOIN HR.JOBS J
ON E.JOB_ID=J.JOB_ID
GROUP BY D.DEPARTMENT_NAME,J.JOB_TITLE
ORDER BY D.DEPARTMENT_NAME;


--FIND THE DEPARTMENTS HAVING MORE THAN 5 EMPLOYEES
SELECT 
DEPARTMENT_ID,
COUNT(EMPLOYEE_ID) AS TOTAL_EMP
FROM HR.EMPLOYEES 
GROUP BY DEPARTMENT_ID
HAVING COUNT(EMPLOYEE_ID)>5;


--LIST ALL EMPLOYEES IN EACH DEPARTMENT USING LISTAGG
SELECT 
DEPARTMENT_ID,
LISTAGG(
    FIRST_NAME||' '||lAST_NAME,','
    )
WITHIN GROUP (ORDER BY FIRST_NAME ASC)AS EMPLOYEE_NAME
FROM HR.EMPLOYEES
GROUP BY DEPARTMENT_ID;


SELECT DEPARTMENT_ID,
AVG(SALARY) AS AVG_SALARY
FROM HR.EMPLOYEES
GROUP BY DEPARTMENT_ID
HAVING AVG(SALARY)>8000;

--MINIMUN ,MAXIMUN AND AVG SALARY BY MANAGER
SELECT MANAGER_ID,
    MIN(SALARY) AS min_salary,
    MAX(SALARY) AS MAX_SALARY,
    AVG(SALARY) AS AVG_SALARY
FROM HR.EMPLOYEES
WHERE MANAGER_ID IS NOT NULL
GROUP BY MANAGER_ID
ORDER BY AVG_SALARY DESC;

SELECT  D.DEPARTMENT_NAME,
        LISTAGG( E.FIRST_NAME||' '||E.LAST_NAME,',')
WITHIN GROUP(ORDER BY E.FIRST_NAME) AS EMPLOYEES
FROM HR.DEPARTMENTS D
    JOIN HR.EMPLOYEES E
ON 
    D.DEPARTMENT_ID=E.DEPARTMENT_ID
GROUP BY D.DEPARTMENT_NAME
ORDER BY D.DEPARTMENT_NAME;

